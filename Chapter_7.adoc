:toc:
:toclevels: 4
:imagesdir: ./

== Chapter 7. Creating Graphical Calculator with JavaFX 

After lots of of code example producing boring outputs to the system console, it's time for creating a nice looking GUI. We're accustomed to programs that open a window with buttons, text fields, menus and the likes. 

Java has an old library of components called Swing, and the new one called JavaFX framework. We'll use only JavaFX in this book.

In this chapter I'll explain you the basics of GUI programming with JavaFX. You'll learn how to create GUI containers and arrange GUI components inside them. In the next chapter you'll learn how to write code that reacts on user's actions (a.k.a. events) like a click on the button or a mouse move. 

By the end of this chapter we'll create a GUI for the calculator that will look like this:

[[FIG7-1]]
.The Calculator
image::images/fig_7_01.png[]

This is just the GUI part. The working version of the calculator will be finished in Chapter 8.

=== Introduction to JavaFX

With JavaFX you can create Graphic User Interface in two ways:

* By writing the code in Java as you did in previous chapters.

* With the help of the visual layout tool called Scene Builder, where you'll be dragging and dropping components on the window and saving the design in the FXML format. Then the Java program will load this _.fxml_ file and display your creation.

I'll show you both ways, but let's start with some basics of development with JavaFX. Let's set the stage, because JavaFX uses theater terminology. 

IntelliJ IDEA will helps you to get stated quickly. Just  create a new project (the menu File | New Project), select JavaFX application as the project type and give a name. In a second a new project will be created with  Two Java classes `Main` and `Controller` and a file named _sample.fxml_ as shown below.

[[FIG7-2]]
.The newly generated IDEA project
image::images/fig_7_02.png[]

The `Main` class of a JavaFX application extends `Application` and is an entry point of your application. JavaFX classes are located in the packages `javafx.stage` and `javafx.scene`.The `main()` method invokes the method `launch()` from `Application`, which in turn will call the method `start()`. 
Then the program loads _sample.fxml_, sets the title of the stage and creates a `Scene` 300 by 275 pixels. 

A JavaFX application has to instantiate a `Stage` object first. Pretend that you're a play director and need to set up one or more scenes (views).  Each scene includes GUI nodes (containers and components).  These node can be instantiate either as Java classes or loaded from the `.fxml` file as it was done in the code generated by IDEA. The content of the generated _sample.fxml_ looks like this:

[source, java]
----
<?import javafx.geometry.Insets?>
<?import javafx.scene.layout.GridPane?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<GridPane fx:controller="sample.Controller"
          xmlns:fx="http://javafx.com/fxml" alignment="center" hgap="10" vgap="10">
</GridPane>
----

FXML is a markup languages based on XML (a popular data presentation format). The idea is to separate the creation of the GUI in a declarative language (FXML) from the application logic (Java). If we didn't use IDEA, the FXML would be generated by Scene Builder. In FXML the GUI is represented by tags located in angle brackets, e.g. `<GridPane>`. Each tag has a matching closing tag that start with a forward slash, e.g. `</GridPane>` and may have attributes (e.g. `alignment="center"`). The `<GridPane>` tag corresponds to the Java class `GrindPane`, which is one of the JavaFX layouts - I'll explain them shortly. Actually and FXML tag has a corresponding Java class.

The generated Java class `Controller` has just the pair of curly braces at this point, but we'll be writing the application logic there. Later on you'll connect the generated FXML views with the Java code of the controller. Run the `Main` program and it'll show an empty window that looks like this:

[[FIG7-3]]
.Running the generated application
image::images/fig_7_03.png[]

=== Brief Overview of JavaFX Layouts 

Users of your application can have computers different screen sizes. JavaFX comes with _layouts_ that help with arranging GUI controls on the scene and keeping the arrangement for different stage sizes (think window sizes). There are following layout container classes (and similarly named FXML tags):

* HBox
* VBox
* FlowPane
* GridPane
* BorderPane
* StackPane
* TilePane
* AnchorPane

The `HBox` class (the horizontal box) places controls in a row next to each other. The vertical box `VBox` places controls vertically. The `FlowPane` places the nodes in a row and then wraps to the next row if there is no room in the current one.

The `GridPane` allows to arrange UI controls in rows and columns and assign constraints (properties) to each cell.

The `BorderPane` splits the scene into five regions, which are called `left`, `top`, `right`, `bottom`, and `center`. 

The `TilePane` layout is similar to the FlowPane, but it places each node in a cell of the same size (like tiles on the wall). Say, you need to display several images in a tile layout. Adding the `ImageView` nodes to the `TilePane` will shows them as tiles next to each other. 

The `StackPane` layout works as a deck of playing cards - only one child node will be shown at a time covering the other nodes.

The `AnchorPane` lets you to anchor nodes at left, top, right, and bottom of the scene. Imagine a music player application with the buttons Rewind on the left and the Fast Forward on the right. The `AncorPane` allows to force the Rewind button to always remain at 20 pixel from the left border of the window and 10 pixels from the bottom even when the window resizes. For that you can use the `leftAnchor` and `bottomAnchor` properties. For example,

[source, java]
----
AnchorPane.setLeftAnchor(rewindBtn, 20);
AnchorPane.setBottomAnchor(rewindBtn, 10);
----

If you'd be writing the code manually in Java, you'd be going through the following steps with any layout:

1. Create instances of child nodes to be used within the layout container.

2. Create an instance of the selected layout class (e.g. `HBox`). This instance will serve as a container and a layout manager for all child nodes that you'll add to it.

3. Add the child nodes to the container using either the method `add()` or `addAll()`.

4. If this layout instance need to be used inside another layout (e.g. an `HBox` can be placed inside the `BorderPane`) add the instance created in Step 1 to the parent container by using the method `add()`.

But it's easier to create layouts and components using a visual tool, and this is what we'll do next.

=== Getting Started With Scene Builder

Scene Builder 2.0 is a visual layout tool for JavaFX applications by Oracle. Download it from http://goo.gl/9jOse6. Follow the http://goo.gl/rCt8x1[installation instructions] for your operational system and install Scene Builder on your computer. In this section I'll show you how to quickly get started with Scene Builder, but you should also watch this helpful https://www.youtube.com/watch?v=rHcnsEoSK_c[Youtube video].

You can start the Scene Builder either independently or from IDEA. For example, if you right-click on the _sample.fxml_ file in your newly generated IDEA project it'll show you a popup menu, which includes the item Open in SceneBuilder. Select this item. The very first time IDEA will ask you to confirm  the location of Scene Builder application on your computer. Then it'll open _sample.fxml_ in Scene Builder. This is how it looks on my computer:

[[FIG7-4]]
.Scene Builder with opened sample.fxml
image::images/fig_7_04.png[]

On the left panel you can select containers, controls, menus, shapes and drag and drop them in the middle panel. Not the GridPanel layout shown at the bottom left - the arrangement of GUI components inside of this scene will be controlled by `GridLayout`. Let me select the Button from the Controls section on the left and drop it in the middle. The Screen Builder's window will look like this:

[[FIG7-5]]
.Adding a button to the scene
image::images/fig_7_05.png[]

The right panel allows you to change the properties of this button. These little boxes with the digit one represent so called row and column constraints - we'll discuss them shortly.

The menu Preview | Show Preview in Window will show how your GUI will look during the right time. So far our one-button screen is not too fancy, and this is how it's preview looks like:

[[FIG7-6]]
.Scene Builder: previewing in window
image::images/fig_7_06.png[]

Let's save the changes in _sample.fxml_ (menu File | Save) and open this file in IDEA. There were no content between `<GridPanel>` and `</GridPanel>`in the generated _sample.fxml_, but now there is:

[source, java]
----
<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import java.lang.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>


<GridPane alignment="center" hgap="10" vgap="10" xmlns:fx="http://javafx.com/fxml/1" xmlns="http://javafx.com/javafx/8" fx:controller="sample.Controller">
   <columnConstraints>
      <ColumnConstraints />
      <ColumnConstraints />
   </columnConstraints>
   <rowConstraints>
      <RowConstraints />
      <RowConstraints />
   </rowConstraints>
   <children>
      <Button mnemonicParsing="false" text="Button" 
         GridPane.columnIndex="1" GridPane.rowIndex="1" />
   </children>
</GridPane>
----



=== Styling with CSS

Each node can be styled using the Cascading Style Sheet (CSS) file. CSS are widely used for styling Web applications. On the top of the scene graph you'll create a root node. 

 In addition to built in layouts you can customize the positioning of the nodes on the scene using CSS.


=== Challenge Yourself

