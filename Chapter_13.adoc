:toc-placement!:
:imagesdir: ./

== Chapter 13. Creating a Ping-Pong Game 

In chapters 6, 7, and 10 you’ve learned how to create simple GUI with JavaFX using such components as buttons, labels and text fields.  This chapter is more about drawing and animating shapes. 

JavaFX includes the package http://docs.oracle.com/javase/8/javafx/api/javafx/scene/shape/package-summary.html[javafx.scene.shape], which includes such classes as `Circle`, `Rectangle`, `Line` and more.

Ping-Pong is a perfect game to illustrate the drawing and animating capabilities of JavaFX. In this game you'll have another chance to work with event handlers, and will use multi-threading. 

=== The Strategy

Let’s come up with some rules of our Ping-Pong game:

1. This game will have two players named Kid and Computer. 
2. The game lasts until one of these players will reach the score of 21.

3. The Kid’s paddle movements will be controlled by the computer mouse.

4.  The game score has to  be displayed at the bottom of the window.

5.  A new game starts when a player presses the N-key on the keyboard, pressing Q will end the game, and the S-key will serve the ball.

6.  Only the Kid can serve the ball.

7.  To win a point the ball should go beyond the paddle when it's not blocking the ball.

8.  When the Computer bounces the ball, it can move only horizontally to the right.

9.  If the ball contacts the Kid’s paddle in the upper half of the table, the ball should be moving in the up-and-left direction.  If the ball was located in the bottom part of the table, it should move in the down-and-left direction.

At first, it seems to be a very challenging task. In programming we often have to break the complicated problem into a set of smaller and simpler tasks. The ability to do so is called _analytical thinking_, and it helps not only in programming, but  everywhere in your life. Do not get frustrated if you can’t achieve a big goal, split it in a set of the smaller ones an reach them one at time!  

Let's start breaking our complex task. Try to visualize a ping-pong table. Can you write a program that will draw a green rectangle? That’s our first goal to achieve. Then we'll add the paddle. Then we'll see how to draw the ball. Learning how to move the ball will be the next task. Writing the keyboard event handlers shouldn't be too difficult.

[[FIG13-1]]
image::images/fig_13_PingPong.png[]


=== Drawing the Ping-Pong Table

In this section or goal is to draw a 2D ping-pong table, which should look as a green rectangle. 

Let's start with creating a new JavaFX project in IntelliJ IDEA selecting JavaFX as a project type. Press Next, and on the next popup window enter PingPong as a project name. Press the button Finish and IDEA will generate a new project for you. Rename (right-click | Refactor | Rename) the file _sample.fxml_ into _pingpong.fxml_, the `Main` class into `PingPong`, and `Controller` into `PingPongController`. The same way change the name of the package from _sample_ to _pong_. 

Now let's draw the ping-pong table in Scene Builder. Right-click on the file _pingpong.fxml_ and open it in Scene Builder. As you've seen in Chapter 7, the generated FXML uses the `<GridBag>` as a default container, and you'll see an empty `GridBag` in the Hierarchy pane. The left side of the SceneBuilder panels will look as follows:

[[FIG13-2]]
image::images/fig_13_Group.png[]

But I'm not going to use any layouts in the PingPong game. The game will consist of a number of shapes that I'll keep in the `Group` container. We haven't use it yet - the `Group` is used just to keep several child components together. Grouping components in a container can come handy, if you need to assign one event handler to all child components or auto-resize all of them as a group.

In Scene Builder delete the GridBag container and drag/drop the Group from the Miscellaneous section down to the Hierarchy pane. Then drag/drop a `Rectangle` from the Shapes panel onto the Group. Resize it an pick a nice green color from the Fill property on the right side (you'll be picking a color from a dropdown palette, and the color code will be inserted automatically). Your Screen Builder should look like this:

[[FIG13-3]]
image::images/fig_13_Rectangle.png[]

Open the file pingpong.fxml and you'll see the tag `<Rectangle>` inside the `<Group>` generated by Scene Builder. Set the width of the `Rectangle` to 400, and the height to 250. It should look like this:

[source, xml]
----
<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.shape.*?>
<?import javafx.scene.*?>
<?import java.lang.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>

<Group xmlns="http://javafx.com/javafx/8" xmlns:fx="http://javafx.com/fxml/1">
   <children>
      <Rectangle arcHeight="5.0" arcWidth="5.0" fill="#31b287" height="250" stroke="BLACK" strokeType="INSIDE" width="400" />
   </children>
</Group>
----

The `archHeight` and `arcWidth` were auto-generated in case you need to create rounded corners in the rectangle. The properties `stroke` and `strokeType` define the look of the rectangle's border. We don't really need to change the default values for these properties, but if you're interested in learning what are they for  visit the http://docs.oracle.com/javase/8/javafx/api/javafx/scene/shape/Rectangle.html[online documentation] for this class.  
Running the auto-generated `PingPong` class will show the following window:

[[FIG13-4]]
image::images/fig_13_HelloWorld.png[]

There are a couple of things that I don't like here. First, the corners of the rectangle are rounded just a little bit. This is caused by the properties `archHeight` and `arcWidth`. I'll remove them from `pingpong.fxml`.  

Second, the window has a title Hello World set by the auto-generated code in IntelliJ IDEA set this title. It's easy to change in the class `PingPong`, but I don't event want to see the title bar! 

This is also an easy change in JavaFX. Set the stage style to `UNDECORATED` will remove the standard window title and borders. But if I'll remove the title bar, I'll lose the ability to close the window by clicking on the circle (or a little cross in Windows) will be gone. A bit later we'll write the code to close the window by pressing the Q-key on the keyboard. At this point the code of the `PingPong` class looks like this:

[source, java]
----
package pong;

import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;
import javafx.stage.StageStyle;

public class PingPong extends Application {

 @Override
 public void start(Stage primaryStage) throws Exception{

    Parent root = FXMLLoader.load(getClass().getResource("pingpong.fxml"));

    primaryStage.setScene(new Scene(root, 400, 250));
    primaryStage.initStyle(StageStyle.UNDECORATED);
    primaryStage.show();
 }


 public static void main(String[] args) {
     launch(args);
 }
}
----

This class was generated by IDEA, but I've removed the Hello World title, set the size of the scene to 400x250, and added the line
`primaryStage.initStyle(StageStyle.UNDECORATED);`. Running the `PingPong` class will display the following green rectangle:

[[FIG13-5]]
image::images/fig_13_undecorated.png[]



We'll have a Ping-Pong table to be centered on the screen. We won't set the hard-coded scene dimensions this time, but rather use the `Screen` class that will check the dimensions of the user's device, center the ping-pong table on the screen and will calculate its dimensions. 

=== Handling Keyboard Events

Every key on the keyboard has a special code assigned. The method `getCode` from the class `KeyEvent` returns the `KeyCode` object that represents the key pressed. But pressing on one key can result in displaying more than one characters (e.g. a small and capital letter.) The method `getCharachter` returns a `String` that represent the character typed by the user.


=== Animating the Node

The class javafx.animation.Timeline allows you to change the values of properties over a time interval. For example, if you'll be changing a Y coordinate of a paddle every second, it'll be moving vertically on the scene.  

The paddle is an instance of the `Line` so we'll be changing the value of its startY attribute for times a second. 